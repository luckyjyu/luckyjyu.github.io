<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Linux学习笔记/linux服务器开发一-基础/Day4/Day4 | Lucky's Blog</title><meta name="description" content="Linux学习笔记/linux服务器开发一-基础/Day4/Day4"><meta name="author" content="Lucky"><meta name="copyright" content="Lucky"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Linux学习笔记/linux服务器开发一-基础/Day4/Day4"><meta name="twitter:description" content="Linux学习笔记/linux服务器开发一-基础/Day4/Day4"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="Linux学习笔记/linux服务器开发一-基础/Day4/Day4"><meta property="og:url" content="http://yoursite.com/2021/01/30/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E4%B8%80-%E5%9F%BA%E7%A1%80/Day4/Day4/"><meta property="og:site_name" content="Lucky's Blog"><meta property="og:description" content="Linux学习笔记/linux服务器开发一-基础/Day4/Day4"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2021/01/30/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E4%B8%80-%E5%9F%BA%E7%A1%80/Day4/Day4/"><link rel="prev" title="Linux学习笔记/linux服务器开发一-基础/Day5/Day5" href="http://yoursite.com/2021/01/30/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E4%B8%80-%E5%9F%BA%E7%A1%80/Day5/Day5/"><link rel="next" title="Linux学习笔记/linux服务器开发一-基础/Day3/Day3" href="http://yoursite.com/2021/01/30/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E4%B8%80-%E5%9F%BA%E7%A1%80/Day3/Day3/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Lucky's Blog" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Lucky's Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">31</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#GDB调试"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">GDB调试</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#简介"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#生成调试信息"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">生成调试信息</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#启动GDB"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">启动GDB</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#查看程序源代码"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">查看程序源代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#设置断点"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">设置断点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#单步调试"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">单步调试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#查看变量的值"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">查看变量的值</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#查看变量的类型"><span class="toc_mobile_items-number">1.8.</span> <span class="toc_mobile_items-text">查看变量的类型</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#设置变量的值"><span class="toc_mobile_items-number">1.9.</span> <span class="toc_mobile_items-text">设置变量的值</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#设置追踪变量"><span class="toc_mobile_items-number">1.10.</span> <span class="toc_mobile_items-text">设置追踪变量</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#退出GDB调试"><span class="toc_mobile_items-number">1.11.</span> <span class="toc_mobile_items-text">退出GDB调试</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#makefile的编写"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">makefile的编写</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#makefile的命名"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">makefile的命名</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#makefile的规则"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">makefile的规则</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#makefile01"><span class="toc_mobile_items-number">2.2.1.</span> <span class="toc_mobile_items-text">makefile01</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#makefile02"><span class="toc_mobile_items-number">2.2.2.</span> <span class="toc_mobile_items-text">makefile02</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#makefile03"><span class="toc_mobile_items-number">2.2.3.</span> <span class="toc_mobile_items-text">makefile03</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#makefile04"><span class="toc_mobile_items-number">2.2.4.</span> <span class="toc_mobile_items-text">makefile04</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#系统IO函数"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">系统IO函数</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#一些概念"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">一些概念</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#C库函的IO缓冲区"><span class="toc_mobile_items-number">3.1.1.</span> <span class="toc_mobile_items-text">C库函的IO缓冲区</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#PCB和文件描述符"><span class="toc_mobile_items-number">3.1.2.</span> <span class="toc_mobile_items-text">PCB和文件描述符</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#库函数与系统函数的关系"><span class="toc_mobile_items-number">3.1.3.</span> <span class="toc_mobile_items-text">库函数与系统函数的关系</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#open"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">open</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#open函数的使用01"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text">open函数的使用01</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#open函数的使用02"><span class="toc_mobile_items-number">3.2.2.</span> <span class="toc_mobile_items-text">open函数的使用02</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#read-amp-write"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">read&amp;write</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#lseek"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">lseek</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#GDB调试"><span class="toc-number">1.</span> <span class="toc-text">GDB调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生成调试信息"><span class="toc-number">1.2.</span> <span class="toc-text">生成调试信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动GDB"><span class="toc-number">1.3.</span> <span class="toc-text">启动GDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看程序源代码"><span class="toc-number">1.4.</span> <span class="toc-text">查看程序源代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置断点"><span class="toc-number">1.5.</span> <span class="toc-text">设置断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#单步调试"><span class="toc-number">1.6.</span> <span class="toc-text">单步调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看变量的值"><span class="toc-number">1.7.</span> <span class="toc-text">查看变量的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看变量的类型"><span class="toc-number">1.8.</span> <span class="toc-text">查看变量的类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置变量的值"><span class="toc-number">1.9.</span> <span class="toc-text">设置变量的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置追踪变量"><span class="toc-number">1.10.</span> <span class="toc-text">设置追踪变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#退出GDB调试"><span class="toc-number">1.11.</span> <span class="toc-text">退出GDB调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#makefile的编写"><span class="toc-number">2.</span> <span class="toc-text">makefile的编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#makefile的命名"><span class="toc-number">2.1.</span> <span class="toc-text">makefile的命名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#makefile的规则"><span class="toc-number">2.2.</span> <span class="toc-text">makefile的规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#makefile01"><span class="toc-number">2.2.1.</span> <span class="toc-text">makefile01</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#makefile02"><span class="toc-number">2.2.2.</span> <span class="toc-text">makefile02</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#makefile03"><span class="toc-number">2.2.3.</span> <span class="toc-text">makefile03</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#makefile04"><span class="toc-number">2.2.4.</span> <span class="toc-text">makefile04</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#系统IO函数"><span class="toc-number">3.</span> <span class="toc-text">系统IO函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一些概念"><span class="toc-number">3.1.</span> <span class="toc-text">一些概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#C库函的IO缓冲区"><span class="toc-number">3.1.1.</span> <span class="toc-text">C库函的IO缓冲区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PCB和文件描述符"><span class="toc-number">3.1.2.</span> <span class="toc-text">PCB和文件描述符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#库函数与系统函数的关系"><span class="toc-number">3.1.3.</span> <span class="toc-text">库函数与系统函数的关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#open"><span class="toc-number">3.2.</span> <span class="toc-text">open</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#open函数的使用01"><span class="toc-number">3.2.1.</span> <span class="toc-text">open函数的使用01</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#open函数的使用02"><span class="toc-number">3.2.2.</span> <span class="toc-text">open函数的使用02</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#read-amp-write"><span class="toc-number">3.3.</span> <span class="toc-text">read&amp;write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lseek"><span class="toc-number">3.4.</span> <span class="toc-text">lseek</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">Linux学习笔记/linux服务器开发一-基础/Day4/Day4</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2021-01-30<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2020-12-12</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="GDB调试"><a href="#GDB调试" class="headerlink" title="GDB调试"></a>GDB调试</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GDB（GNU Debugger）是GCC的调试工具。其功能强大，现描述如下：</span><br><span class="line">GDB主要帮忙你完成下面四个方面的功能：</span><br><span class="line">1.启动你的程序，可以按照你的自定义的要求随心所欲的运行程序。</span><br><span class="line">2.可让被调试的程序在你所指定的调置的断点处停住。（断点可以是条件表达式）</span><br><span class="line">3.当程序被停住时，可以检查此时你的程序中所发生的事。</span><br><span class="line">4.动态的改变你程序的执行环境。</span><br></pre></td></tr></table></figure></div>

<h3 id="生成调试信息"><a href="#生成调试信息" class="headerlink" title="生成调试信息"></a>生成调试信息</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一般来说GDB主要调试的是C&#x2F;C++的程序。要调试C&#x2F;C++的程序，首先在编译时，我们必须要把调试信息加到可执行文件中。使用编译器（cc&#x2F;gcc&#x2F;g++）的 -g 参数可以做到这一点。如：</span><br><span class="line">    gcc -g hello.c -o hello</span><br><span class="line">    g++ -g hello.cpp -o hello</span><br><span class="line">    如果没有-g，你将看不见程序的函数名、变量名，所代替的全是运行时的内存地址。当你用-g把调试信息加入之后，并成功编译目标代码以后，让我们来看看如何用gdb来调试他。</span><br></pre></td></tr></table></figure></div>

<h3 id="启动GDB"><a href="#启动GDB" class="headerlink" title="启动GDB"></a>启动GDB</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb app （app为执行文件）</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206221235300.png" data-fancybox="group" data-caption="image-20201206221235300" class="fancybox"><img alt="image-20201206221235300" title="image-20201206221235300" data-src="image-20201206221235300.png" class="lazyload"></a></p>
<p>对比没加-g和加了-g的执行文件的大小，加了-g的包含的调试信息</p>
<p><a href="image-20201206222208258.png" data-fancybox="group" data-caption="image-20201206222208258" class="fancybox"><img alt="image-20201206222208258" title="image-20201206222208258" data-src="image-20201206222208258.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start：只执行一行代码</span><br><span class="line">run&#x2F;r：直接执行停在断点处</span><br><span class="line">运行前记得打断点，否则直接运行完毕</span><br></pre></td></tr></table></figure></div>



<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">next&#x2F;n---&gt;单步执行</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206224359816.png" data-fancybox="group" data-caption="image-20201206224359816" class="fancybox"><img alt="image-20201206224359816" title="image-20201206224359816" data-src="image-20201206224359816.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">continue&#x2F;c---&gt;继续运行程序，停在下一个断点</span><br></pre></td></tr></table></figure></div>



<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">step&#x2F;s---&gt;单步跟踪，函数调进入被调用函数体内</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206224744734.png" data-fancybox="group" data-caption="image-20201206224744734" class="fancybox"><img alt="image-20201206224744734" title="image-20201206224744734" data-src="image-20201206224744734.png" class="lazyload"></a></p>
<h3 id="查看程序源代码"><a href="#查看程序源代码" class="headerlink" title="查看程序源代码"></a>查看程序源代码</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l----&gt;默认显示包含main函数的文件（默认每次10行）</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206222455337.png" data-fancybox="group" data-caption="image-20201206222455337" class="fancybox"><img alt="image-20201206222455337" title="image-20201206222455337" data-src="image-20201206222455337.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l + 查看文件名 ：行号</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206222743817.png" data-fancybox="group" data-caption="image-20201206222743817" class="fancybox"><img alt="image-20201206222743817" title="image-20201206222743817" data-src="image-20201206222743817.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l + 文件名 ： 函数名</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206222840519.png" data-fancybox="group" data-caption="image-20201206222840519" class="fancybox"><img alt="image-20201206222840519" title="image-20201206222840519" data-src="image-20201206222840519.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">1、继续按l就是查看后续代码内容</span><br><span class="line">2、直接回车代表执行上一条操作</span><br></pre></td></tr></table></figure></div>



<h3 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b---break  设置断点，可以简写为b</span><br><span class="line">b 10   设置断点，在源程序第10行</span><br><span class="line">b func 设置断点，在func函数入口处</span><br><span class="line">b fileName：行号（函数名）</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206223238791.png" data-fancybox="group" data-caption="image-20201206223238791" class="fancybox"><img alt="image-20201206223238791" title="image-20201206223238791" data-src="image-20201206223238791.png" class="lazyload"></a></p>
<p>设置条件断点：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b 5 if i&#x3D;&#x3D;5</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206224228360.png" data-fancybox="group" data-caption="image-20201206224228360" class="fancybox"><img alt="image-20201206224228360" title="image-20201206224228360" data-src="image-20201206224228360.png" class="lazyload"></a></p>
<p>删除断点：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete---del---d</span><br><span class="line">d 断点编号</span><br></pre></td></tr></table></figure></div>



<p>获取断点编号：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info&#x2F;i b查看断点信息</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206224256216.png" data-fancybox="group" data-caption="image-20201206224256216" class="fancybox"><img alt="image-20201206224256216" title="image-20201206224256216" data-src="image-20201206224256216.png" class="lazyload"></a></p>
<h3 id="单步调试"><a href="#单步调试" class="headerlink" title="单步调试"></a>单步调试</h3><p>进入函数体内部：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s</span><br></pre></td></tr></table></figure></div>

<p>从函数体内部跳出：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">finish</span><br><span class="line">注意：查看是否在循环体内打了断点，去掉才能跳出函数体</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207150155688.png" data-fancybox="group" data-caption="image-20201207150155688" class="fancybox"><img alt="image-20201207150155688" title="image-20201207150155688" data-src="image-20201207150155688.png" class="lazyload"></a></p>
<p>不进入函数体内部：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n</span><br></pre></td></tr></table></figure></div>

<p>退出当前循环：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207145651414.png" data-fancybox="group" data-caption="image-20201207145651414" class="fancybox"><img alt="image-20201207145651414" title="image-20201207145651414" data-src="image-20201207145651414.png" class="lazyload"></a></p>
<h3 id="查看变量的值"><a href="#查看变量的值" class="headerlink" title="查看变量的值"></a>查看变量的值</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print 打印变量、字符串、表达式等的值，可简写为p</span><br><span class="line">p count 打印count的值</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206225156486.png" data-fancybox="group" data-caption="image-20201206225156486" class="fancybox"><img alt="image-20201206225156486" title="image-20201206225156486" data-src="image-20201206225156486.png" class="lazyload"></a></p>
<h3 id="查看变量的类型"><a href="#查看变量的类型" class="headerlink" title="查看变量的类型"></a>查看变量的类型</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ptype 查看变量类型</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206225240149.png" data-fancybox="group" data-caption="image-20201206225240149" class="fancybox"><img alt="image-20201206225240149" title="image-20201206225240149" data-src="image-20201206225240149.png" class="lazyload"></a></p>
<h3 id="设置变量的值"><a href="#设置变量的值" class="headerlink" title="设置变量的值"></a>设置变量的值</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set var i&#x3D;10</span><br><span class="line">相当于for循环已经循环了10次</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207150421494.png" data-fancybox="group" data-caption="image-20201207150421494" class="fancybox"><img alt="image-20201207150421494" title="image-20201207150421494" data-src="image-20201207150421494.png" class="lazyload"></a></p>
<h3 id="设置追踪变量"><a href="#设置追踪变量" class="headerlink" title="设置追踪变量"></a>设置追踪变量</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display i</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206225440760.png" data-fancybox="group" data-caption="image-20201206225440760" class="fancybox"><img alt="image-20201206225440760" title="image-20201206225440760" data-src="image-20201206225440760.png" class="lazyload"></a></p>
<p>取消追踪变量：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">undisplay i（编号）</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207145533852.png" data-fancybox="group" data-caption="image-20201207145533852" class="fancybox"><img alt="image-20201207145533852" title="image-20201207145533852" data-src="image-20201207145533852.png" class="lazyload"></a></p>
<p>获取编号：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info display  查看追踪变量信息</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201206225707558.png" data-fancybox="group" data-caption="image-20201206225707558" class="fancybox"><img alt="image-20201206225707558" title="image-20201206225707558" data-src="image-20201206225707558.png" class="lazyload"></a></p>
<h3 id="退出GDB调试"><a href="#退出GDB调试" class="headerlink" title="退出GDB调试"></a>退出GDB调试</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quit&#x2F;q</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207150521207.png" data-fancybox="group" data-caption="image-20201207150521207" class="fancybox"><img alt="image-20201207150521207" title="image-20201207150521207" data-src="image-20201207150521207.png" class="lazyload"></a></p>
<h2 id="makefile的编写"><a href="#makefile的编写" class="headerlink" title="makefile的编写"></a>makefile的编写</h2><h3 id="makefile的命名"><a href="#makefile的命名" class="headerlink" title="makefile的命名"></a>makefile的命名</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Makefile&#x2F;makefile</span><br></pre></td></tr></table></figure></div>



<h3 id="makefile的规则"><a href="#makefile的规则" class="headerlink" title="makefile的规则"></a>makefile的规则</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">规则中的三要素: 目标，依赖，命令</span><br><span class="line">目标：依赖条件</span><br><span class="line">	命令</span><br><span class="line">	1、第一条规则是用来生成终极目标的规则</span><br><span class="line">		1&gt;、如果规则中的依赖不存在，向下寻找其他规则</span><br><span class="line">		2&gt;、更新机制：比较的是目标文件和依赖文件的时间</span><br><span class="line">	</span><br><span class="line">子目标和终极目标的关系:</span><br><span class="line">更新目标的原则:</span><br></pre></td></tr></table></figure></div>

<p>makefile基本原则：</p>
<p><a href="1_makefile%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99.png" data-fancybox="group" data-caption="1_makefile基本原则" class="fancybox"><img alt="1_makefile基本原则" title="1_makefile基本原则" data-src="1_makefile%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99.png" class="lazyload"></a></p>
<h4 id="makefile01"><a href="#makefile01" class="headerlink" title="makefile01"></a><strong>makefile01</strong></h4><p>（其中的.c、.h文件在上一篇Day3中给出自取）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app:main.c add.c sub.c mul.c div.c</span><br><span class="line">	gcc main.c add.c sub.c mul.c div.c -o app</span><br><span class="line"></span><br><span class="line">app---目标</span><br><span class="line">*.c---依赖</span><br><span class="line">gcc main.c add.c sub.c mul.c div.c -o app---命令</span><br></pre></td></tr></table></figure></div>

<p>执行：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207221500577.png" data-fancybox="group" data-caption="image-20201207221500577" class="fancybox"><img alt="image-20201207221500577" title="image-20201207221500577" data-src="image-20201207221500577.png" class="lazyload"></a></p>
<p>缺点：每执行一次就把所有的文件重新编译，浪费时间</p>
<h4 id="makefile02"><a href="#makefile02" class="headerlink" title="makefile02"></a><strong>makefile02</strong></h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app:main.o add.o sub.o mul.o div.o</span><br><span class="line">	gcc main.o add.o sub.o mul.o div.o -o app</span><br><span class="line">main.o:main.c</span><br><span class="line">	gcc -c main.c -o main.o</span><br><span class="line">add.o:add.c</span><br><span class="line">	gcc -c add.c -o add.o</span><br><span class="line">sub.o:sub.c</span><br><span class="line">	gcc -c sub.c -o sub.o</span><br><span class="line">mul.o:mul.c</span><br><span class="line">	gcc -c mul.c -o mul.o</span><br><span class="line">div.o:div.c</span><br><span class="line">	gcc -c div.c -o div.o</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app---终极目标</span><br><span class="line">*.o---子目标（与依赖有关，为生成依赖而服务的）</span><br><span class="line">执行过程：发现没有main.o等依赖时就向下寻找生成依赖的规则</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207222607769.png" data-fancybox="group" data-caption="image-20201207222607769" class="fancybox"><img alt="image-20201207222607769" title="image-20201207222607769" data-src="image-20201207222607769.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看*.o对应的生成时间：ls -l *.o</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207222738071.png" data-fancybox="group" data-caption="image-20201207222738071" class="fancybox"><img alt="image-20201207222738071" title="image-20201207222738071" data-src="image-20201207222738071.png" class="lazyload"></a></p>
<p>证明该改进版的makefile不会重复编译：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、将其中一个函数修改，比如add.c</span><br><span class="line">2、make执行看对应的执行命令</span><br><span class="line">（如图可知，</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201207223032603.png" data-fancybox="group" data-caption="image-20201207223032603" class="fancybox"><img alt="image-20201207223032603" title="image-20201207223032603" data-src="image-20201207223032603.png" class="lazyload"></a></p>
<p>makefile工作原理：</p>
<p><a href="2_makefile%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-1.png" data-fancybox="group" data-caption="2_makefile工作原理-1" class="fancybox"><img alt="2_makefile工作原理-1" title="2_makefile工作原理-1" data-src="2_makefile%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-1.png" class="lazyload"></a></p>
<p><a href="3_makefile%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-2.png" data-fancybox="group" data-caption="3_makefile工作原理-2" class="fancybox"><img alt="3_makefile工作原理-2" title="3_makefile工作原理-2" data-src="3_makefile%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-2.png" class="lazyload"></a></p>
<p>解释：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">若想生成目标，检查规则中的依赖条件是否存在，如果不存在，寻找是否有规则用来生成该依赖文件</span><br><span class="line"></span><br><span class="line">检查规则中的目标是否需要更新，必须检查它的所有依赖，依赖中有任意一个被更新，则目标必须更新</span><br><span class="line">(依赖文件比目标文件时间晚，则需要更新)</span><br></pre></td></tr></table></figure></div>

<p>由于代码中存在大量的冗余，故将其设置为变量的形式</p>
<h4 id="makefile03"><a href="#makefile03" class="headerlink" title="makefile03"></a><strong>makefile03</strong></h4><p>普通变量：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">变量定义及赋值：obj &#x3D; a.o b.o c.o</span><br><span class="line">变量取值：foo &#x3D; $(obj)</span><br><span class="line">由 Makefile 维护的一些变量（通常格式都是大写）：</span><br><span class="line">1、有默认值变量</span><br><span class="line">CC：默认值 cc</span><br><span class="line">2、无默认值变量</span><br><span class="line">CPPFLAGS : 预处理器需要的选项 如：-I</span><br><span class="line">CFLAGS：编译的时候使用的参数 –Wall –g -c</span><br><span class="line">LDFLAGS ：链接库使用的选项 –L -l</span><br><span class="line">注：用户可以修改这些变量的默认值，例如：CC &#x3D; gcc</span><br></pre></td></tr></table></figure></div>

<p>自动变量：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">变量：</span><br><span class="line">（只能用于命令中）</span><br><span class="line">$@ --&gt; 规则中的目标</span><br><span class="line">$&lt; --&gt; 规则中的第一个依赖条件</span><br><span class="line">$^ --&gt; 规则中的所有依赖条件</span><br><span class="line">模式规则：</span><br><span class="line">在规则的目标定义中使用 %（%表示一个或多个）</span><br><span class="line">在规则的依赖条件中使用 %</span><br><span class="line">示例：</span><br><span class="line">%.o:%.c</span><br><span class="line">	$(CC) –c  $&lt; -o $@</span><br><span class="line">（$&lt; --&gt; 表示依次取出依赖条件、$@ --&gt; 表示依次取出目标值）</span><br></pre></td></tr></table></figure></div>



<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">obj&#x3D;main.o add.o sub.o mul.o div.o</span><br><span class="line">target&#x3D;app</span><br><span class="line">CC&#x3D;gcc</span><br><span class="line">CPPFLAGS&#x3D;-I</span><br><span class="line">$(target):$(obj)</span><br><span class="line">	$(CC) $(obj) -o $(target)</span><br><span class="line">%.o:%.c</span><br><span class="line">	$(CC) -c $&lt; -o $@</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208200904781.png" data-fancybox="group" data-caption="image-20201208200904781" class="fancybox"><img alt="image-20201208200904781" title="image-20201208200904781" data-src="image-20201208200904781.png" class="lazyload"></a></p>
<h4 id="makefile04"><a href="#makefile04" class="headerlink" title="makefile04"></a><strong>makefile04</strong></h4><p>makefile中的函数：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wildcard：查找指定目录下指定类型的文件并返回</span><br><span class="line">src&#x3D;$(wildcard ~&#x2F;aa&#x2F;*.c)</span><br><span class="line">例如：返回main.c add.c sub.c mul.c div.c</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">patsubst：匹配替换函数</span><br><span class="line">obj&#x3D;$(patsubst %.c,%.o,$(src))</span><br></pre></td></tr></table></figure></div>



<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">target&#x3D;app</span><br><span class="line">#函数</span><br><span class="line">src&#x3D;$(wildcard .&#x2F;*.c)</span><br><span class="line">obj&#x3D;$(patsubst .&#x2F;%.c,.&#x2F;%.o,$(src))</span><br><span class="line">CC&#x3D;gcc</span><br><span class="line">CPPFLAGS&#x3D;-I</span><br><span class="line">$(target):$(obj)</span><br><span class="line">	$(CC) $(obj) -o $(target)</span><br><span class="line">%.o:%.c</span><br><span class="line">	$(CC) -c $&lt; -o $@</span><br><span class="line">clean:</span><br><span class="line">	rm $(obj) $(target)</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208210402311.png" data-fancybox="group" data-caption="image-20201208210402311" class="fancybox"><img alt="image-20201208210402311" title="image-20201208210402311" data-src="image-20201208210402311.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208210700335.png" data-fancybox="group" data-caption="image-20201208210700335" class="fancybox"><img alt="image-20201208210700335" title="image-20201208210700335" data-src="image-20201208210700335.png" class="lazyload"></a></p>
<p>注意：要执行最后一句clean（伪目标），则在命令行输入make clean，之前的命令不会被执行，若只是执行make则依次从上到下执行，不会生成clean</p>
<p>解决无待删除文件时，执行make clean执行错误：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clean:</span><br><span class="line">	rm $(obj) $(target) -f</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208211109249.png" data-fancybox="group" data-caption="image-20201208211109249" class="fancybox"><img alt="image-20201208211109249" title="image-20201208211109249" data-src="image-20201208211109249.png" class="lazyload"></a></p>
<p>解决在clean目标存在时，无法执行make clean情况：</p>
<p><a href="image-20201208211318771.png" data-fancybox="group" data-caption="image-20201208211318771" class="fancybox"><img alt="image-20201208211318771" title="image-20201208211318771" data-src="image-20201208211318771.png" class="lazyload"></a></p>
<p>将clean设置为伪目标，使得目录下的clean与makefile中的clean没有关系</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.PHONY:clean</span><br><span class="line">clean:</span><br><span class="line">	rm $(obj) $(target) -f</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208211550016.png" data-fancybox="group" data-caption="image-20201208211550016" class="fancybox"><img alt="image-20201208211550016" title="image-20201208211550016" data-src="image-20201208211550016.png" class="lazyload"></a></p>
<p>解决命令执行失败后续命令无法执行的情况：</p>
<p><a href="image-20201208211923086.png" data-fancybox="group" data-caption="image-20201208211923086" class="fancybox"><img alt="image-20201208211923086" title="image-20201208211923086" data-src="image-20201208211923086.png" class="lazyload"></a></p>
<p><a href="image-20201208212138415.png" data-fancybox="group" data-caption="image-20201208212138415" class="fancybox"><img alt="image-20201208212138415" title="image-20201208212138415" data-src="image-20201208212138415.png" class="lazyload"></a></p>
<p>在rm命令上添加命令，该命令会出错，由于普通用户无权限在根目录下创建目录，后续命令也无法执行</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.PHONY:clean</span><br><span class="line">clean:</span><br><span class="line">	-mkdir &#x2F;aa   ----&gt;加“-”表示执行错误忽略该命令继续执行</span><br><span class="line">	rm $(obj) $(target) -f</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208212244175.png" data-fancybox="group" data-caption="image-20201208212244175" class="fancybox"><img alt="image-20201208212244175" title="image-20201208212244175" data-src="image-20201208212244175.png" class="lazyload"></a></p>
<p>执行成功，app和*.o被成功删除</p>
<h2 id="系统IO函数"><a href="#系统IO函数" class="headerlink" title="系统IO函数"></a>系统IO函数</h2><h3 id="一些概念"><a href="#一些概念" class="headerlink" title="一些概念"></a>一些概念</h3><h4 id="C库函的IO缓冲区"><a href="#C库函的IO缓冲区" class="headerlink" title="C库函的IO缓冲区"></a>C库函的IO缓冲区</h4><p>在图中，除了fopen以外的C库函数的形参中都有一个FILE*类型的指针，该指针对应一个结构体，里面有文件描述符（对应磁盘上的文件）、文件读写指针位置（若不关闭文件，继续读文件，默认在文件末尾故读不到，所有时刻注意指针位置）以及I/O缓冲区（提高读写速度，以免每次都需要进行对硬盘的读写操作，一次性将缓冲区数据刷到硬盘上）。 </p>
<p>C库I/O函数工作流程</p>
<p><a href="4_C%E5%BA%93IO%E5%87%BD%E6%95%B0%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" data-fancybox="group" data-caption="4_C库IO函数工作流程" class="fancybox"><img alt="4_C库IO函数工作流程" title="4_C库IO函数工作流程" data-src="4_C%E5%BA%93IO%E5%87%BD%E6%95%B0%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" class="lazyload"></a></p>
<h4 id="PCB和文件描述符"><a href="#PCB和文件描述符" class="headerlink" title="PCB和文件描述符"></a>PCB和文件描述符</h4><p>Linux每运行一个进程就分配一个地址空间，0-3G为用户区，3G-4G为内核区（用户不能操作），在内核区有一个PCB进程控制块，里面有一个1024大小的数组，每打开一个新文件就在文件描述符表中占用一个位置，前三个已经被占用，例如：3、4、5被占用，关闭上，再打开一个文件则占用关闭的位置3。</p>
<p><a href="5_pcb%E5%92%8C%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6.png" data-fancybox="group" data-caption="5_pcb和文件描述符" class="fancybox"><img alt="5_pcb和文件描述符" title="5_pcb和文件描述符" data-src="5_pcb%E5%92%8C%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6.png" class="lazyload"></a></p>
<p><a href="6_%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4.png" data-fancybox="group" data-caption="6_虚拟地址空间" class="fancybox"><img alt="6_虚拟地址空间" title="6_虚拟地址空间" data-src="6_%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看文件类型：</span><br><span class="line">file app</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208220529641.png" data-fancybox="group" data-caption="image-20201208220529641" class="fancybox"><img alt="image-20201208220529641" title="image-20201208220529641" data-src="image-20201208220529641.png" class="lazyload"></a></p>
<p>可知，可执行文件是一个ELF类型的文件，全局变量如果被初始化一定不为0，如果赋值为0也被认为是未初始化全局变量（局部变量未初始化值不一定）。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cpu 为什么要使用虚拟地址空间与物理地址空间映射？解决了什么样的问题？</span><br><span class="line"></span><br><span class="line">1.方便编译器和操作系统安排程序的地址分布。</span><br><span class="line">程序可以使用一系列相邻的虚拟地址来访问物理内存中不相邻的大内存缓冲区。（解决不连续缓冲区的问题）</span><br><span class="line">		</span><br><span class="line">2.方便进程之间隔离</span><br><span class="line">不同进程使用的虚拟地址彼此隔离。一个进程中的代码无法更改正在由另一进程使用的物理内存。</span><br><span class="line">		</span><br><span class="line">3.方便OS使用你那可怜的内存。</span><br><span class="line">程序可以使用一系列虚拟地址来访问大于可用物理内存的内存缓冲区。当物理内存的供应量变小时，内存管理器会将物理内存页（通常大小为 4 KB）保存到磁盘文件。数据或代码页会根据需要在物理内存与磁盘之间移动。</span><br></pre></td></tr></table></figure></div>

<p>注意：虚拟出来的4G空间并不意味着内存少4G，而是程序运行实际需要占用多少才会少多少，只是说至多少4G。</p>
<h4 id="库函数与系统函数的关系"><a href="#库函数与系统函数的关系" class="headerlink" title="库函数与系统函数的关系"></a>库函数与系统函数的关系</h4><p><a href="7_%E5%BA%93%E5%87%BD%E6%95%B0%E4%B8%8E%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0%E7%9A%84%E5%85%B3%E7%B3%BB.png" data-fancybox="group" data-caption="7_库函数与系统函数的关系" class="fancybox"><img alt="7_库函数与系统函数的关系" title="7_库函数与系统函数的关系" data-src="7_%E5%BA%93%E5%87%BD%E6%95%B0%E4%B8%8E%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0%E7%9A%84%E5%85%B3%E7%B3%BB.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Q：printf是如何将字符串显示到屏幕上的？</span><br><span class="line">A：printf是一个库函数，不可能直接调用硬件，而是一层一层往下调用，首先C函数会维护一个FILE*，其中包含文件描述符、文件读写指针和缓冲区，缓冲区存放着要打印输出的内容；之后向下调用Linux系统API，包含三层，应用层、系统调用和内核层，应用层的函数操作的是虚拟地址空间的用户区（0-3G），应用层的write函数拿到了文件描述符、字符串以及字符长度；sys_write()再去调用显示器的驱动，显示字符串。</span><br></pre></td></tr></table></figure></div>



<h3 id="open"><a href="#open" class="headerlink" title="open"></a>open</h3><p>查看系统函数的man文档</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man 2 open</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208223641321.png" data-fancybox="group" data-caption="image-20201208223641321" class="fancybox"><img alt="image-20201208223641321" title="image-20201208223641321" data-src="image-20201208223641321.png" class="lazyload"></a></p>
<p><strong>函数参数</strong>：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">调用open函数所需的头文件，以及函数的参数设置</span><br><span class="line">如果文件已经存在，则用第一种两个参数的函数；</span><br><span class="line">如果文件不存在，则用第二种三个参数的函数；</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208224115287.png" data-fancybox="group" data-caption="image-20201208224115287" class="fancybox"><img alt="image-20201208224115287" title="image-20201208224115287" data-src="image-20201208224115287.png" class="lazyload"></a></p>
<p><strong>打开方式</strong>：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">其中flag必须有O_RDONLY、O_WRONLY、O_RDWR，且这三个互斥，也可以追加如O_CREAT、O_DIRECTORY等，例如文件不存在时需要追加O_CREAT</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208224325511.png" data-fancybox="group" data-caption="image-20201208224325511" class="fancybox"><img alt="image-20201208224325511" title="image-20201208224325511" data-src="image-20201208224325511.png" class="lazyload"></a></p>
<p><strong>函数返回值</strong>：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于函数的返回值，函数返回其对应的文件描述符，若出错则返回-1</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208224601149.png" data-fancybox="group" data-caption="image-20201208224601149" class="fancybox"><img alt="image-20201208224601149" title="image-20201208224601149" data-src="image-20201208224601149.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">并且有一个errno（全局变量）也被设置，是记录系统的最后一次错误代码。代码是一个int型的值。</span><br><span class="line">每个errno值对应着以字符串表示的错误类型</span><br><span class="line">当调用&quot;某些&quot;函数出错时，该函数会重新设置 errno 的值</span><br></pre></td></tr></table></figure></div>

<p>如何使用errno？</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">若需使用errno的值，需包含errno.h这个头文件（位于&#x2F;usr&#x2F;include&#x2F;errno.h)，extern声明证明该int型变量是一个全局变量。</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201208225412038.png" data-fancybox="group" data-caption="image-20201208225412038" class="fancybox"><img alt="image-20201208225412038" title="image-20201208225412038" data-src="image-20201208225412038.png" class="lazyload"></a></p>
<h4 id="open函数的使用01"><a href="#open函数的使用01" class="headerlink" title="open函数的使用01"></a>open函数的使用01</h4><p>1、打开一个不存在的文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#incude<span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="comment">//打开不存在文件</span></span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">"not exit"</span>,O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open file"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="built_in">close</span>(fd);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ret=%d\n"</span>,ret);</span><br><span class="line">    <span class="keyword">if</span>(ret == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open file"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201209102148487.png" data-fancybox="group" data-caption="image-20201209102148487" class="fancybox"><img alt="image-20201209102148487" title="image-20201209102148487" data-src="image-20201209102148487.png" class="lazyload"></a></p>
<p>2、打开已存在文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">touch hello.c</span><br><span class="line"></span><br><span class="line">修改myopen.c</span><br><span class="line">fd = <span class="built_in">open</span>(<span class="string">"hello.c"</span>,O_RDWR);</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201209102552340.png" data-fancybox="group" data-caption="image-20201209102552340" class="fancybox"><img alt="image-20201209102552340" title="image-20201209102552340" data-src="image-20201209102552340.png" class="lazyload"></a></p>
<p>3、创建一个不存在文件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#incude<span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="comment">//打开不存在文件</span></span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">"test.txt"</span>,O_RDWR | O_CREAT,<span class="number">0777</span>);</span><br><span class="line">    <span class="comment">//权限全开</span></span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open file"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="built_in">close</span>(fd);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ret=%d\n"</span>,ret);</span><br><span class="line">    <span class="keyword">if</span>(ret == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open file"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>创建文件成功！</p>
<p>代码中设置文件权限全开，查看文件实际权限</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l text.txt</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201209105228786.png" data-fancybox="group" data-caption="image-20201209105228786" class="fancybox"><img alt="image-20201209105228786" title="image-20201209105228786" data-src="image-20201209105228786.png" class="lazyload"></a></p>
<p>解释：如图文件权限并不是777，是因为文件本身有一个权限，文件实际权限是给定权限与本地掩码（取反）相与的结果。</p>
<p>打开方式：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">必选项:</span><br><span class="line">		O_RDONLY</span><br><span class="line">		O_WRONLY</span><br><span class="line">		O_RDWR</span><br><span class="line">可选项:</span><br><span class="line">		O_CREAT</span><br><span class="line">            文件权限: 本地有一个掩码</span><br><span class="line">            文件的实际权限:</span><br><span class="line">            给定的权限</span><br><span class="line">            本地掩码(取反)</span><br><span class="line">           &amp;</span><br><span class="line">            实际的文件权限</span><br><span class="line">            777</span><br><span class="line">            111111111</span><br><span class="line">            111111101</span><br><span class="line">            111111101</span><br><span class="line">            775</span><br><span class="line">									</span><br><span class="line">		O_TRUNC</span><br><span class="line">		O_EXCL</span><br><span class="line">		O_APPEND</span><br></pre></td></tr></table></figure></div>

<h4 id="open函数的使用02"><a href="#open函数的使用02" class="headerlink" title="open函数的使用02"></a>open函数的使用02</h4><p>1、判断文件是否存在</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O_CREAT | O_EXCL必须一同使用才能进行判断</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#incude<span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="comment">//打开不存在文件</span></span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">"test.txt"</span>,O_RDWR | O_CREAT | O_EXCL,<span class="number">0777</span>);</span><br><span class="line">    <span class="comment">//权限全开</span></span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open file"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);<span class="comment">//关闭当前进程</span></span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="built_in">close</span>(fd);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ret=%d\n"</span>,ret);</span><br><span class="line">    <span class="keyword">if</span>(ret == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open file"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201209110218326.png" data-fancybox="group" data-caption="image-20201209110218326" class="fancybox"><img alt="image-20201209110218326" title="image-20201209110218326" data-src="image-20201209110218326.png" class="lazyload"></a></p>
<p>如图，第二次执行./app时，由于text.txt已经存在，故给出已存在提示。</p>
<p>读写大文件两种方式：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">read write --- 每次读1byte</span><br><span class="line">getc putc ---- 每次读一个byte -- 效率高</span><br><span class="line">（因为标准C库函数，内部有一个缓冲区）</span><br><span class="line"></span><br><span class="line">解释：调用c库函数时，每次先将数据缓冲在用户区，写满时，再一次性将缓冲区数据放入内核区，然后内核区再调用硬件设备写到磁盘；</span><br><span class="line">调用系统函数时，是写一个bit就进行一次用户区到内核区的切换，转换的速度很慢，故效率低。</span><br><span class="line">内核区也维护了一个缓冲区，将缓冲区一次性刷到磁盘，时间适当节省。</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201211092653480.png" data-fancybox="group" data-caption="image-20201211092653480" class="fancybox"><img alt="image-20201211092653480" title="image-20201211092653480" data-src="image-20201211092653480.png" class="lazyload"></a></p>
<h3 id="read-amp-write"><a href="#read-amp-write" class="headerlink" title="read&amp;write"></a>read&amp;write</h3><p>1、查看read的man文档</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man 2 read</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201209110520228.png" data-fancybox="group" data-caption="image-20201209110520228" class="fancybox"><img alt="image-20201209110520228" title="image-20201209110520228" data-src="image-20201209110520228.png" class="lazyload"></a></p>
<p>2、read函数返回值</p>
<p><a href="image-20201209110555570.png" data-fancybox="group" data-caption="image-20201209110555570" class="fancybox"><img alt="image-20201209110555570" title="image-20201209110555570" data-src="image-20201209110555570.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. -1 读文件失败（同时设置errno）</span><br><span class="line">2. 0 文件读完了</span><br><span class="line">3. &gt;0 读取的字节数</span><br></pre></td></tr></table></figure></div>

<p>3、查看write的man文档</p>
<p><a href="image-20201209110910083.png" data-fancybox="group" data-caption="image-20201209110910083" class="fancybox"><img alt="image-20201209110910083" title="image-20201209110910083" data-src="image-20201209110910083.png" class="lazyload"></a></p>
<p> 4、操练</p>
<p>read_write.c</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//open file</span></span><br><span class="line">    <span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"english.txt"</span>,O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open()"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> fd1 = <span class="built_in">open</span>(<span class="string">"newfile"</span>,O_CREAD | O_WRONLY,<span class="number">0664</span>);</span><br><span class="line">    <span class="keyword">if</span>(fd1 == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open1()"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> bud[<span class="number">2048</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="built_in">read</span>(fd,buf,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    <span class="keyword">if</span>(count == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"read()"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(count)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="built_in">write</span>(fd1,buf,count);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"write bytes %d\n"</span>,ret);</span><br><span class="line">        count = <span class="built_in">read</span>(fd,buf,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">    <span class="built_in">close</span>(fd1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc read_write.c -o readwrite</span><br><span class="line">ls</span><br><span class="line">.&#x2F;readwrite</span><br><span class="line">ls -l newfile english.txt</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201211101216193.png" data-fancybox="group" data-caption="image-20201211101216193" class="fancybox"><img alt="image-20201211101216193" title="image-20201211101216193" data-src="image-20201211101216193.png" class="lazyload"></a></p>
<p><a href="image-20201211101302972.png" data-fancybox="group" data-caption="image-20201211101302972" class="fancybox"><img alt="image-20201211101302972" title="image-20201211101302972" data-src="image-20201211101302972.png" class="lazyload"></a></p>
<p>如图，文件大小一样，读写成功。其中的perror，每次在错误发生时，系统会去修改全局变量errno的值，perror每次就会去读取errno的值，找寻对应的错误信息打印。</p>
<h3 id="lseek"><a href="#lseek" class="headerlink" title="lseek"></a>lseek</h3><p>功能：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 获取文件大小</span><br><span class="line">2. 移动文件指针</span><br><span class="line">3. 文件拓展</span><br></pre></td></tr></table></figure></div>

<p>查看lssek的man文档：</p>
<p><a href="image-20201209111100770.png" data-fancybox="group" data-caption="image-20201209111100770" class="fancybox"><img alt="image-20201209111100770" title="image-20201209111100770" data-src="image-20201209111100770.png" class="lazyload"></a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"english.txt"</span>,O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open()"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ret1 = lseek(fd,<span class="number">0</span>,SEEK_END);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"file length = %d\n"</span>,ret1);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> ret2 = lseek(fd,<span class="number">2000</span>,SEEK_END);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"return value:%d\n"</span>,ret2);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">write</span>(fd,<span class="string">"a"</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a href="image-20201211103523527.png" data-fancybox="group" data-caption="image-20201211103523527" class="fancybox"><img alt="image-20201211103523527" title="image-20201211103523527" data-src="image-20201211103523527.png" class="lazyload"></a></p>
<p><a href="image-20201211103544889.png" data-fancybox="group" data-caption="image-20201211103544889" class="fancybox"><img alt="image-20201211103544889" title="image-20201211103544889" data-src="image-20201211103544889.png" class="lazyload"></a></p>
<p>如图可知，english.txt的大小从129030–&gt;131031，因为需要用lseek拓展文件成功需要最后在最后进行写操作，多写了一个a字符，所以字符数增加了2001。</p>
</div></article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/01/30/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E4%B8%80-%E5%9F%BA%E7%A1%80/Day5/Day5/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>Linux学习笔记/linux服务器开发一-基础/Day5/Day5</span></div></a></div><div class="next-post pull_right"><a href="/2021/01/30/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E4%B8%80-%E5%9F%BA%E7%A1%80/Day3/Day3/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>Linux学习笔记/linux服务器开发一-基础/Day3/Day3</span></div></a></div></nav></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Lucky</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/tw_cn.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>